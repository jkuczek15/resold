<?php
/**
 * Google Maps location template
 *
 * @var $block \Magento\Catalog\Block\Product\View
 */
  $latitude_attr = $block->getProduct()->getCustomAttribute('latitude');
  $longitude_attr = $block->getProduct()->getCustomAttribute('longitude');
  if($latitude_attr != null && $longitude_attr != null){
    $latitude = $latitude_attr->getValue();
    $longitude = $longitude_attr->getValue();
?>
<style>
#map { position:relative; top:0; bottom:0; width:600px; height: 400px; }
.marker {
    display: block;
    border: none;
    border-radius: 50%;
    padding: 0;
    opacity: 0.4;
}
</style>
<div style="display: flex;">
  <div id='map'></div>
</div>
<script>
require(['https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js', 'jquery'], (mapboxgl, $) => {
  $(document).ready(() => {
    mapboxgl.accessToken = 'pk.eyJ1Ijoiamt1Y3playIsImEiOiJjamxlZ2kyMzYwMnhsM3ByazM1ZWtibzllIn0.hsE3V5wLucE2wl8jdQhfTQ';
    var geojson = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "iconSize": [115, 115],
                'icon-opacity': 0.2
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    <?= $longitude ?>,
                    <?= $latitude ?>
                ]
            }
        }
      ]
    };
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/streets-v9', // stylesheet location
        center: [<?= $longitude ?>, <?= $latitude ?>], // starting position [lng, lat]
        zoom: 9, // starting zoom
        minZoom: 9,
        maxZoom: 9,
        interactive: false
    });
    // add markers to map
    geojson.features.forEach(function(marker) {
        // create a DOM element for the marker
        var el = document.createElement('div');
        el.className = 'marker';
        el.style.backgroundImage = 'url(https://resold.us/pub/media/wysiwyg/circle.png)';
        el.style.width = marker.properties.iconSize[0] + 'px';
        el.style.height = marker.properties.iconSize[1] + 'px';

        // add marker to map
        new mapboxgl.Marker(el).setLngLat(marker.geometry.coordinates).addTo(map);
    });
  });
});
</script>
<?php
  }
